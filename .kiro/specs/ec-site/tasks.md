# 実装タスクリスト: ECサイト

---

- [x] 1. プロジェクト基盤のセットアップ
- [x] 1.1 (P) バックエンドの技術基盤を整備する
  - mise でランタイムバージョンを固定し、Hono / Drizzle / Zod v4 の依存関係を構成する
  - Cloudflare Workers のデプロイ設定を作成し、D1・R2・Durable Objects・Queues のバインディングを定義する
  - TypeScript の厳格モード設定を行う
  - _Requirements: 22.1_
- [x] 1.2 (P) フロントエンドの技術基盤を整備する
  - Nuxt3 / Vue3 / Zod v4 / Pinia の依存関係を構成する
  - Cloudflare Workers 向けのビルド設定を行う
  - 認証状態・カート・ウィッシュリストのグローバルストアの骨格を作成する
  - _Requirements: 20.3_

---

- [x] 2. データベーススキーマとマイグレーションの定義
- [x] 2.1 イベントストアのテーブルスキーマを定義する
  - 集約ID・バージョン番号の複合ユニーク制約を持つイベントテーブルを定義する（楽観的ロックの根拠）
  - イベントの追記のみを許可し、更新・削除を受け付けない制約を設定する
  - _Requirements: 22.1, 22.2, 22.4_
- [x] 2.2 読み取りモデルの全テーブルスキーマを定義する
  - 商品・カテゴリ・注文（コンビニ払い払込票番号カラム含む）・ユーザー・住所・ウィッシュリスト・リフレッシュトークン・パスワードリセットトークン・メールアドレス確認トークン・メール再送試行管理の各テーブルを定義する
  - 商品の検索・価格帯絞り込み・注文の顧客別・ステータス別ソートに必要なインデックスを設定する
  - リフレッシュトークンテーブルにユーザーID のインデックスを追加する（パスワードリセット時の全トークン無効化・ユーザー別検索の性能確保）
  - _Requirements: 1.1, 1.3, 1.4, 7.3, 9.4, 10.3, 12.1, 17.1, 18.5, 21.1, 21.2, 23.1, 24.1_

---

- [x] 3. ドメイン共有基盤の実装
- [x] 3.1 共有値オブジェクトとイベントエンベロープを実装する
  - 商品ID・注文ID・ユーザーID・カテゴリID・メールアドレス（RFC5322）・価格（0以上整数）・在庫数（0以上整数）の型と不変条件を定義する
  - すべてのドメインイベントに共通するエンベロープ（集約ID・集約種別・バージョン・タイムスタンプ・ペイロード）の型を定義する
  - すべての型を不変（readonly）で定義し、変更は新オブジェクトを返す関数として定義する
  - _Requirements: 22.1_

---

- [x] 4. 各ドメイン集約の実装
- [x] 4.1 (P) 商品・カテゴリドメインの集約とイベントを実装する
  - 公開済み/非公開・在庫数・在庫状況・価格・画像URLリストを持つ商品集約を定義する
  - 価格が0未満を拒否し、在庫数が負にならない不変条件を設定する
  - 商品作成・更新・論理削除・在庫変更・画像関連付けの各ドメインイベントを判別共用体で定義する
  - カテゴリ名が1文字以上100文字以内の不変条件を持つカテゴリ集約を定義する
  - _Requirements: 13.3, 13.5, 14.2, 14.3, 15.1_
- [x] 4.2 (P) 注文ドメインの集約とイベントを実装する
  - 注文明細・配送先住所・決済方法・小計・送料・合計・ステータスを持つ不変集約を定義する
  - ステータス遷移ルール（受付→発送→完了、受付/発送→キャンセルのみ合法）を不変条件として定義する
  - 注文作成・決済完了・コンビニ払い発行・発送・完了・キャンセル・返金完了の各ドメインイベントを判別共用体で定義する
  - _Requirements: 6.5, 17.3, 17.4, 17.5, 18.1, 18.2_
- [x] 4.3 (P) ユーザードメインの集約とイベントを実装する
  - メールアドレス・パスワードハッシュ・ロール（顧客/管理者）・メール認証済みフラグ・ログイン失敗回数・ロック解除日時を持つ不変集約を定義する
  - 5回連続ログイン失敗後に15分間のアカウントロックが適用される不変条件を定義する
  - ユーザー登録・メール認証・パスワードリセット要求/完了・ログイン失敗・アカウントロック/解除の各ドメインイベントを判別共用体で定義する
  - _Requirements: 8.2, 9.3, 20.1_

---

- [x] 5. インフラ層: イベントストアと認証サービスの実装
- [x] 5.1 (P) イベントストアを実装する
  - 集約IDと期待バージョンを受け取り、バージョン不一致時に VERSION_CONFLICT エラーを返すイベント追記機能を実装する
  - 集約IDを指定して全イベントを昇順で取得する機能を実装する
  - Miniflare 上で楽観的ロック競合シナリオのテストを実装する
  - _Requirements: 22.1, 22.2, 22.4_
- [x] 5.2 (P) JWT 認証サービスを実装する
  - アクセストークン（有効期限1時間）の生成・検証を実装する
  - リフレッシュトークン（有効期限30日）の生成・D1への保存・検証・無効化を実装する
  - 署名不正・期限切れトークンの検証失敗を認証エラーとして返す機能を実装する
  - _Requirements: 9.1, 9.4, 9.5, 20.5_

---

- [x] 6. インフラ層: 読み取りリポジトリ群の実装
- [x] 6.1 (P) 商品・カテゴリの読み取りリポジトリを実装する
  - キーワード（商品名・説明への部分一致）・カテゴリID・価格帯の複合条件フィルタリングとページネーション（最大50件）を実装する
  - 公開済み商品のみを返す条件フィルタを実装する
  - 商品IDで単一商品を取得し在庫状況（IN_STOCK / OUT_OF_STOCK）を返す機能を実装する
  - カテゴリ一覧取得と名前重複チェックを実装する
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7, 2.1, 2.2, 2.3, 2.4, 2.5, 15.3_
- [x] 6.2 (P) 注文読み取りリポジトリを実装する
  - ユーザーIDを指定した注文一覧取得（注文日降順）とオーナーシップ検証を実装する
  - 管理者向けのステータス・日付範囲フィルター付き全注文一覧取得を実装する
  - 注文IDによる詳細取得（注文明細・配送先・コンビニ払い払込票番号含む）を実装する
  - _Requirements: 12.1, 12.2, 12.3, 12.4, 17.1, 17.2_
- [x] 6.3 (P) ユーザー・住所・ウィッシュリストリポジトリを実装する
  - メールアドレスによるユーザー取得とログイン失敗回数・ロック状態の更新を実装する
  - 住所の CRUD を実装し、他ユーザーの住所への操作を拒否する制御を含める
  - ウィッシュリストの追加（重複拒否）・削除・登録日降順一覧取得を実装する
  - キーワード（氏名・メールアドレス）による会員検索と会員詳細（注文履歴・住所含む）取得を実装する
  - _Requirements: 3.1, 3.2, 3.3, 3.4, 11.3, 11.4, 11.5, 11.7, 19.1, 19.2, 19.3, 19.4_

---

- [x] 7. インフラ層: 外部サービス・カートの実装
- [x] 7.1 (P) 決済ゲートウェイを実装する
  - クレジットカード決済（拒否時 PAYMENT_DECLINED エラー返却）を実装する
  - コンビニ払い払込票番号の発行（支払期限72時間）を実装する
  - 代引き手数料の加算計算を実装する
  - 返金処理とコンビニ払い払込票無効化を実装する
  - カード番号・CVV をログ・イベントペイロード・DBに一切記録しない制約を実装する
  - _Requirements: 6.1, 6.2, 6.3, 6.4, 6.7, 18.3, 18.5, 20.2_
- [x] 7.2 (P) メールサービスを実装する
  - 注文確認メール（注文番号・明細・送料・合計・配送先住所を含む）の送信を実装する
  - パスワードリセットメール・メールアドレス確認メール・返金完了通知メールの送信を実装する
  - _Requirements: 7.1, 7.2, 8.1, 10.1, 18.4_
- [x] 7.3 メール再送キュー基盤を実装する
  - 注文確定後に Cloudflare Queues へメール送信メッセージをエンキューする機能を実装する
  - キューコンシューマーとしてメール送信を試行し、失敗時に D1 で試行回数を管理する機能を実装する
  - 残試行回数がある場合は30分遅延で再エンキューし、3回上限到達時はエラーログを記録する機能を実装する
  - 同一メッセージの重複送信を防ぐべき等処理を実装する
  - _Requirements: 7.3, 7.4_
- [x] 7.4 (P) 画像リポジトリを実装する
  - JPEG・PNG・WebP ファイルを Cloudflare R2 に保存し公開URLを返す機能を実装する
  - サポート外のファイル形式（400 + UNSUPPORTED_IMAGE_FORMAT）と 10MB 超過（413 + FILE_TOO_LARGE）を拒否する検証を実装する
  - _Requirements: 16.1, 16.2, 16.3_
- [x] 7.5 (P) カート Durable Object を実装する
  - ユーザー/セッションごとに独立したカート状態を Durable Object で管理する機能を実装する
  - 商品追加時に D1 読み取りモデルから在庫数を確認し、在庫0の場合と数量超過の場合を拒否する機能を実装する
  - 数量変更（0指定で削除）・削除・カート内容取得（現在価格で合計再計算）を実装する
  - _Requirements: 4.1, 4.2, 4.3, 4.4, 4.5, 4.6, 4.7, 4.8_

---

- [x] 8. インフラ層: 投影サービスの実装
- [x] 8.1 (P) 商品・カテゴリの投影処理を実装する
  - 商品作成・更新・論理削除・在庫変更・画像関連付けイベントを受け取り、読み取りモデルを即時更新する処理を実装する
  - イベント発行から読み取りモデル更新までが同一リクエスト内で完結することを検証するテストを実装する
  - _Requirements: 13.4, 13.5, 14.1, 14.3, 16.4, 22.3_
- [x] 8.2 (P) 注文の投影処理を実装する
  - 注文作成・決済完了・コンビニ払い発行（払込票番号・支払期限）・発送・完了・キャンセル・返金完了イベントを受け取り、読み取りモデルを即時更新する処理を実装する
  - _Requirements: 6.5, 17.3, 17.4, 18.1, 18.4, 22.3_
- [x] 8.3 (P) ユーザーの投影処理を実装する
  - メールアドレス確認完了イベントを受け取り、ユーザーテーブルのメール確認済みフラグを即時更新する処理を実装する
  - _Requirements: 23.1, 22.3_

---

- [x] 9. アプリケーション層: 商品・カテゴリ・在庫・画像のコマンドとクエリの実装
- [x] 9.1 (P) 商品CRUDコマンドを実装する
  - 商品登録・更新・論理削除の各コマンドにおいて集約をイベント再生で復元し、ドメインイベントをイベントストアへ追記し、投影を同期実行する処理を実装する
  - 登録時の必須項目バリデーション・価格バリデーション・存在しない商品IDへの操作拒否を実装する
  - 管理者ロール以外のアクセスを拒否する制御を実装する
  - _Requirements: 13.1, 13.2, 13.3, 13.4, 13.5, 13.6, 13.7_
- [x] 9.2 (P) 在庫更新コマンドを実装する
  - 在庫数を指定値に更新するコマンドを実装し、0未満の値を拒否する検証を実装する
  - 在庫数が0になった場合に OUT_OF_STOCK 状態へ遷移させる投影との連携を実装する
  - _Requirements: 14.1, 14.2, 14.3, 14.4_
- [x] 9.3 (P) カテゴリ管理コマンドを実装する
  - カテゴリ作成（名前重複時409）・削除（商品紐付き時409）の各コマンドを実装する
  - _Requirements: 15.1, 15.2, 15.4, 15.5_
- [x] 9.4 (P) 画像管理コマンドを実装する
  - 画像アップロード（R2保存・URL返却）コマンドを実装する
  - 商品への画像関連付けコマンド（10枚上限超過時400）を実装する
  - _Requirements: 16.1, 16.4, 16.5_
- [x] 9.5 (P) 商品・カテゴリクエリを実装する
  - 複数条件の組み合わせ検索とページネーション付き商品一覧取得を実装する
  - 商品詳細（画像URL・在庫状況含む）の取得と404ハンドリングを実装する
  - カテゴリ一覧取得を実装する
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7, 2.1, 2.2, 2.3, 2.4, 2.5, 15.3_

---

- [x] 10. アプリケーション層: 注文コマンドとクエリの実装
- [x] 10.1 チェックアウトと決済コマンドを実装する
  - チェックアウト開始（カートが空の場合400）・配送先バリデーション・配送方法選択と送料加算確認の各処理を実装する
  - 決済実行時に在庫確認・決済プロバイダー連携・イベント発行・在庫減少投影・メールエンキューを実装する
  - 楽観的ロックにより同時並行決済の競合を検出する処理を実装する
  - 決済タイムアウト30秒内での完了または PAYMENT_TIMEOUT エラー返却を実装する
  - _Requirements: 5.1, 5.2, 5.3, 5.4, 5.5, 5.6, 5.7, 6.1, 6.2, 6.3, 6.4, 6.5, 6.6, 21.3_
- [x] 10.2 注文ステータス管理コマンドを実装する
  - 受付→発送・発送→完了のステータス遷移を強制するコマンドを実装する
  - 不正遷移時に現在ステータスと遷移可能ステータス一覧を返す処理を実装する
  - _Requirements: 17.3, 17.4, 17.5_
- [x] 10.3 注文キャンセル・返金コマンドを実装する
  - 受付/発送ステータスの注文キャンセル（在庫復元イベント発行・コンビニ払い払込票無効化）を実装する
  - 完了済み注文のキャンセル拒否（400 + ORDER_ALREADY_COMPLETED）を実装する
  - クレジットカード決済済み注文の返金（外部プロバイダー連携・返金完了通知メールエンキュー）を実装する
  - _Requirements: 18.1, 18.2, 18.3, 18.4, 18.5_
- [x] 10.4 (P) 注文クエリを実装する
  - 自ユーザーの注文一覧（注文日降順）取得とオーナーシップ検証（他ユーザー注文は403）を実装する
  - 管理者向けのステータス・日付範囲フィルター付き全注文一覧取得を実装する
  - _Requirements: 12.1, 12.2, 12.3, 12.4, 17.1, 17.2_

---

- [x] 11. アプリケーション層: ユーザー・認証コマンドとクエリの実装
- [x] 11.1 会員登録・ログイン・ログアウト・トークン管理コマンドを実装する
  - メールアドレス形式バリデーション（不正形式は400）・パスワード8文字未満拒否・重複メールアドレス拒否（409）を実装する
  - パスワードをコスト係数12以上の bcrypt でハッシュ化して保存する処理を実装する
  - メールアドレス確認メールのエンキューを実装する
  - ログイン成功時にアクセストークン（1時間）とリフレッシュトークン（30日）を返す処理を実装する
  - 5回連続失敗時のアカウントロック（15分・423エラー）と正常ログイン後のカウンターリセットを実装する
  - リフレッシュトークンによるアクセストークン再発行を実装する
  - ログアウト時に現在のリフレッシュトークンをデータストア上で無効化する処理を実装する
  - 無効化済みリフレッシュトークンによるトークン更新リクエストを401で拒否する処理を実装する
  - _Requirements: 8.1, 8.2, 8.3, 8.4, 9.1, 9.2, 9.3, 9.4, 9.5, 20.1, 24.1, 24.2_
- [x] 11.2 パスワードリセットコマンドを実装する
  - リセットリンク（有効期限1時間）の発行とメール送信をエンキューする処理を実装する
  - 未登録メールアドレスへのリクエストも200を返し、メールは送信しない（アドレス存在有無の漏洩防止）処理を実装する
  - リセット完了時のパスワード更新と当該ユーザーの全リフレッシュトークン無効化を実装する
  - 有効期限切れ・使用済みトークンを410で拒否する処理を実装する
  - _Requirements: 10.1, 10.2, 10.3, 10.4, 10.5_
- [x] 11.3 メールアドレス確認コマンドを実装する
  - 確認リンクに含まれるトークンを受け取り、有効性（有効期限・使用済みフラグ）を検証する処理を実装する
  - 検証成功時にアカウントのメール確認済みフラグを有効化し、トークンを使用済みに更新する処理を実装する
  - 有効期限切れのトークンに410と VERIFICATION_TOKEN_EXPIRED エラーコードを返す処理を実装する
  - 使用済みのトークンに410と VERIFICATION_TOKEN_USED エラーコードを返す処理を実装する
  - _Requirements: 23.1, 23.2, 23.3_
- [x] 11.4 住所帳管理コマンドを実装する
  - 住所登録（郵便番号・都道府県・市区町村・番地・氏名・電話番号の必須バリデーション）を実装する
  - 10件上限超過時の拒否（400 + ADDRESS_BOOK_LIMIT_EXCEEDED）を実装する
  - 住所更新・削除における他ユーザー住所への操作拒否（403）を実装する
  - _Requirements: 11.1, 11.2, 11.4, 11.5, 11.6, 11.7_
- [x] 11.5 ウィッシュリストコマンドを実装する
  - ウィッシュリスト追加（重複時409）・削除を実装する
  - 未認証アクセスへの401返却を実装する
  - _Requirements: 3.1, 3.2, 3.4, 3.5_
- [x] 11.6 (P) ユーザー・住所・ウィッシュリスト・会員クエリを実装する
  - 自ユーザーのウィッシュリスト一覧（登録日降順）・住所一覧取得を実装する
  - 管理者向けの会員一覧（キーワード検索付き）・会員詳細（注文履歴・住所含む）取得を実装する
  - 存在しない会員IDへのアクセスに404を返す処理を実装する
  - _Requirements: 3.3, 11.3, 19.1, 19.2, 19.3, 19.4_

---

- [x] 12. プレゼンテーション層の実装
- [x] 12.1 認証・認可ミドルウェアとエラーハンドラーを実装する
  - アクセストークンを検証し不正・期限切れトークンを401で拒否するミドルウェアを実装する
  - 管理者ロール（ADMIN）チェックを行い非管理者アクセスを403で拒否するミドルウェアを実装する
  - 全エラーを統一レスポンス形式（エラーコード・メッセージ・フィールド一覧）に変換するグローバルハンドラーを実装する
  - _Requirements: 20.4, 20.5_
- [x] 12.2 顧客向けAPIルート群を実装する
  - 商品一覧・詳細・ウィッシュリスト・カート・チェックアウト・決済・注文・住所・認証の各エンドポイントを実装する
  - 全エンドポイントに Zod v4 によるリクエストバリデーションを適用する
  - 各エンドポイントが対応するコマンド/クエリハンドラーを呼び出す処理を実装する
  - _Requirements: 1.1, 2.1, 3.1, 4.1, 5.1, 6.1, 7.1, 8.1, 9.1, 10.1, 11.1, 12.1_
- [x] 12.3 管理者向けAPIルート群を実装する
  - 商品CRUD・在庫更新・カテゴリ管理・画像アップロード・注文管理・会員管理の各エンドポイントを実装する
  - 全管理者ルートに管理者認証ミドルウェアを適用する
  - _Requirements: 13.1, 14.1, 15.1, 16.1, 17.1, 18.1, 19.1_

---

- [x] 13. フロントエンド: 認証・アカウント管理画面の実装
- [x] 13.1 会員登録・ログイン・パスワードリセット画面を実装する
  - メールアドレス・パスワードの入力フォームとクライアントサイドバリデーションを実装する
  - ログイン失敗・アカウントロック状態のエラーメッセージ表示を実装する
  - パスワードリセット要求フォームと新パスワード設定フォームを実装する
  - 認証状態をグローバルストアで管理し、認証済みルートを保護する処理を実装する
  - _Requirements: 8.1, 9.1, 9.2, 9.3, 10.1, 10.3_
- [x] 13.2 (P) 住所帳管理画面を実装する
  - 住所の登録・編集・削除フォームと一覧表示を実装する
  - バリデーションエラーの項目名一覧表示を実装する
  - _Requirements: 11.1, 11.3, 11.4, 11.5_
- [x] 13.3 (P) 注文履歴・詳細画面を実装する
  - 注文一覧（注文日降順）と注文詳細（明細・配送先・ステータス）の表示を実装する
  - _Requirements: 12.1, 12.2_

---

- [x] 14. フロントエンド: 商品閲覧・購買フロー画面の実装
- [x] 14.1 (P) 商品一覧・詳細・ウィッシュリスト画面を実装する
  - キーワード・カテゴリ・価格帯の絞り込みフォームとページネーション付き商品リストを実装する
  - 商品詳細（画像・説明・価格・在庫状況）の表示を実装する
  - ウィッシュリストへの追加・削除ボタンと一覧表示を実装する
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 2.1, 2.2, 2.3, 3.1, 3.3, 3.4_
- [x] 14.2 (P) カート・チェックアウト・決済画面を実装する
  - カート内商品の一覧・数量変更・削除と現在価格での合計リアルタイム表示を実装する
  - 配送先住所の選択または新規入力フォームと配送方法選択・送料加算表示を実装する
  - クレジットカード・コンビニ払い・代引きの各決済フォームを実装する
  - 決済完了後の注文確認画面へのリダイレクトを実装する
  - _Requirements: 4.4, 4.6, 4.7, 5.1, 5.3, 5.5, 6.1, 6.3, 6.4_

---

- [x] 15. フロントエンド: 管理者画面の実装
- [x] 15.1 (P) 商品・カテゴリ・在庫・画像管理画面を実装する
  - 商品の登録・編集・削除フォームと一覧表示を実装する
  - 在庫数直接更新フォームを実装する
  - カテゴリ作成・削除フォームと一覧表示を実装する
  - 商品への画像アップロード・関連付けインターフェースを実装する
  - _Requirements: 13.1, 13.4, 13.5, 14.1, 15.1, 15.3, 15.5, 16.1, 16.4_
- [x] 15.2 (P) 注文・顧客管理画面を実装する
  - 全注文一覧（ステータス・日付フィルター付き）と注文ステータス更新ボタンを実装する
  - 注文キャンセル・返金処理の実行インターフェースを実装する
  - 会員一覧（キーワード検索付き）と会員詳細（注文履歴・住所含む）表示を実装する
  - _Requirements: 17.1, 17.2, 17.3, 17.4, 18.1, 18.3, 19.1, 19.2, 19.3_

---

- [x] 16. テストの実装
- [x] 16.1 (P) ドメイン層のユニットテストを実装する
  - 商品集約の価格バリデーション・在庫増減・論理削除の各不変条件をテストする
  - 注文集約のステータス遷移の合法ルート・違法ルート全パターンをテストする
  - ユーザー集約のアカウントロック条件（5回失敗・15分経過後の解除）をテストする
  - 値オブジェクトの有効・無効境界値をテストする
  - _Requirements: 13.3, 14.2, 14.3, 17.3, 17.4, 17.5, 18.1, 18.2, 9.3, 20.1_
- [x] 16.2 (P) アプリケーション層のユニットテストを実装する
  - 各コマンドハンドラーがイベントストア・リポジトリをモックして期待するイベントを生成することをテストする
  - 各クエリハンドラーがリポジトリをモックしてフィルター・ページネーション条件を正しく渡すことをテストする
  - 投影サービスの各イベント入力に対する読み取りモデル更新マッピングをテストする
  - _Requirements: 1.1, 1.5, 6.6, 9.3, 13.1, 14.1, 17.5, 22.2_
- [x] 16.3 (P) インフラ層の統合テストを実装する
  - Miniflare 上で実D1を使用し、楽観的ロック競合・CRUD・フィルター・ページネーションをテストする
  - Miniflare 上で実 Durable Object を使用し、カートへの並行書き込み競合をテストする
  - _Requirements: 4.1, 4.2, 4.3, 6.6, 22.2_
- [x] 16.4 購買・認証・管理者フローの E2E テストを実装する
  - 商品閲覧→カート追加→チェックアウト→決済（モック）→注文確認の購買フロー全体をテストする
  - 会員登録→ログイン→トークンリフレッシュ→パスワードリセットの認証フロー全体をテストする
  - 商品登録→在庫更新→注文ステータス変更の管理者フロー全体をテストする
  - Playwright を使用して Nuxt3 画面遷移・フォームバリデーションをテストする
  - _Requirements: 1.1, 4.1, 5.1, 6.1, 8.1, 9.1, 10.1, 13.1, 14.1, 17.3_
- [x] 16.5 (P) セキュリティテストを実装する
  - 他ユーザーのリソース（注文・住所）へのアクセスが403になることを検証する
  - 管理者ロールなしのアクセスが403を返すことを検証する
  - 署名不正な JWT が401を返すことを検証する
  - ログ・レスポンス・イベントペイロードにクレジットカード番号が含まれないことを検証する
  - _Requirements: 6.7, 11.6, 12.3, 13.7, 20.2, 20.4, 20.5_
